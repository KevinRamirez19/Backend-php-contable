  services:
    app:
      build:
        context: ./
        dockerfile: Dockerfile
      image: concesionario-app
      container_name: concesionario-app
      restart: unless-stopped
      working_dir: /var/www
      volumes:  
        - ./:/var/www
      environment:
        - DB_HOST=db
        - DB_PORT=3306
        - DB_DATABASE=concesionario
        - DB_USERNAME=concesionario_user
        - DB_PASSWORD=secret123
      networks:
        - concesionario-network
      depends_on:
        - db

    webserver:
      image: nginx:alpine
      container_name: concesionario-webserver
      restart: unless-stopped
      ports:
        - "8000:80"
      volumes:
        - ./:/var/www
        - ./docker/nginx/conf.d/:/etc/nginx/conf.d/
      networks:
        - concesionario-network
      depends_on:
        - app

    db:
      image: mysql:8.0
      container_name: concesionario-db
      restart: unless-stopped
      environment:
        MYSQL_DATABASE: concesionario
        MYSQL_ROOT_PASSWORD: root123
        MYSQL_PASSWORD: secret123
        MYSQL_USER: concesionario_user
      ports:
        - "3306:3306"
      volumes:
        - dbdata:/var/lib/mysql
      networks:
        - concesionario-network

    phpmyadmin:
      image: phpmyadmin/phpmyadmin
      container_name: concesionario-pma
      environment:
        PMA_HOST: db
        PMA_PORT: 3306
        PMA_USER: concesionario_user
        PMA_PASSWORD: secret123
        MYSQL_ROOT_PASSWORD: root123
      ports:
        - "8080:80"
      networks:
        - concesionario-network
      depends_on:
        - db

  volumes:
    dbdata:
      driver: local

  networks:
    concesionario-network:
      driver: bridge